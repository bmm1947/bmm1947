         % Button pushed function: MotionButton

    % Ensure data exists
    if isempty(app.DataTable)
        uialert(app.UIFigure, 'No data loaded. Import an Excel file first.', 'Missing Data');
        return;
    end
    if isempty(app.SelectedVar)
        uialert(app.UIFigure, 'Please select a variable from the dropdown.', 'Missing Selection');
        return;
    end

    % Extract table and variables
    T = app.DataTable;
    t = app.TimeVector;
    chosen = app.SelectedVar;

    % Check if chosen variable exists
    if ~ismember(chosen, T.Properties.VariableNames)
        uialert(app.UIFigure, sprintf('Selected variable "%s" not found.', chosen), 'Error');
        return;
    end

    % Extract data series
    y = T.(chosen);

    % Prepare latitude, longitude, altitude data
    lat = []; lon = []; alt = [];
    if ~isempty(app.LatName) && ismember(app.LatName, T.Properties.VariableNames)
        lat = T.(app.LatName);
    end
    if ~isempty(app.LonName) && ismember(app.LonName, T.Properties.VariableNames)
        lon = T.(app.LonName);
    end
    if ~isempty(app.AltName) && ismember(app.AltName, T.Properties.VariableNames)
        alt = T.(app.AltName);
    end

    % Set up for animation
    N = numel(y);
    if N < 2
        uialert(app.UIFigure, 'Not enough data points to animate.', 'Insufficient data');
        return;
    end

    % Clear previous plots
    cla(app.UIAxes);
    cla(app.UIAxes_lat);
    cla(app.UIAxes_lon);
    cla(app.UIAxes_alt);

    % Initialize plots with first point
    mainLine = plot(app.UIAxes, t(1), y(1), '-*', ...
        'LineWidth', 2, 'Color', [0 0.45 0.74], 'MarkerFaceColor', [0 0.45 0.74]);
    xlabel(app.UIAxes, 'Sample Index');
    ylabel(app.UIAxes, chosen);
    title(app.UIAxes, sprintf('Animated Plot: %s', chosen), 'FontWeight','bold');
    grid(app.UIAxes, 'on');
    hold(app.UIAxes, 'on');

    if ~isempty(lat)
        latLine = plot(app.UIAxes_lat, t(1), lat(1), '-.', 'Color',[0.85 0.33 0.1], 'LineWidth',1.8);
        title(app.UIAxes_lat, 'Latitude vs Time');
        xlabel(app.UIAxes_lat, 'Sample Index');
        ylabel(app.UIAxes_lat, 'Latitude');
        grid(app.UIAxes_lat, 'on');
        hold(app.UIAxes_lat, 'on');
    end

    if ~isempty(lon)
        lonLine = plot(app.UIAxes_lon, t(1), lon(1), '-.', 'Color',[0.47 0.67 0.19], 'LineWidth',1.8);
        title(app.UIAxes_lon, 'Longitude vs Time');
        xlabel(app.UIAxes_lon, 'Sample Index');
        ylabel(app.UIAxes_lon, 'Longitude');
        grid(app.UIAxes_lon, 'on');
        hold(app.UIAxes_lon, 'on');
    end

    if ~isempty(alt)
        altLine = plot(app.UIAxes_alt, t(1), alt(1), '-.', 'Color',[0.49 0.18 0.56], 'LineWidth',1.8);
        title(app.UIAxes_alt, 'Altitude vs Time');
        xlabel(app.UIAxes_alt, 'Sample Index');
        ylabel(app.UIAxes_alt, 'Altitude');
        grid(app.UIAxes_alt, 'on');
        hold(app.UIAxes_alt, 'on');
    end

    % === Motion animation loop ===
    % adjust frame rate here (pause seconds)
    pauseTime = 0.15;  % 0.1 = faster, 0.3 = slower

    for i = 2:N
        % Update main plot
        set(mainLine, 'XData', t(1:i), 'YData', y(1:i));
        drawnow limitrate;

        % Update Lat/Lon/Alt plots if available
        if ~isempty(lat)
            set(latLine, 'XData', t(1:i), 'YData', lat(1:i));
        end
        if ~isempty(lon)
            set(lonLine, 'XData', t(1:i), 'YData', lon(1:i));
        end
        if ~isempty(alt)
            set(altLine, 'XData', t(1:i), 'YData', alt(1:i));
        end

        drawnow;
        pause(pauseTime);  % Control animation speed
    end

    % Keep final plots displayed
    hold(app.UIAxes, 'off');
    if ~isempty(lat); hold(app.UIAxes_lat, 'off'); end
    if ~isempty(lon); hold(app.UIAxes_lon, 'off'); end
    if ~isempty(alt); hold(app.UIAxes_alt, 'off'); end
    
    
